{% extends "admin-base.html" %}
{% load static %}

{% block js %} {{block.super}}
<script type="text/javascript" src="{% static 'js/new-course/app.js' %}">// must be the 1º</script>
<script type="text/javascript" src="{% static 'js/factories/timtec-models.js' %}">// must be the 2º</script>
<script type="text/javascript" src="{% static 'js/filters/text.js' %}"></script>
<script type="text/javascript" src="{% static 'js/new-course/directives.js' %}"></script>
<script type="text/javascript" src="{% static 'js/directives/alertPopup.js' %}"></script>
<script type="text/javascript" src="{% static 'js/directives/contenteditable.js' %}"></script>
<script type="text/javascript" src="{% static 'js/directives/fixedBar.js' %}"></script>
<script type="text/javascript" src="{% static 'js/directives/markdowneditor.js' %}"></script>
<script type="text/javascript" src="{% static 'js/directives/sortable.js' %}"></script>
<script type="text/javascript" src="{% static 'js/new-course/controllers.js' %}"></script>
{% endblock %}

{% block content %}

<!--  COURSE CONTENT  -->
<div id="course" class="course-intro" ng-app="new-course" ng-controller="CourseEditController">

    <!-- ACTIONS -->
    <div class="actions" fixed-bar>
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <button class="btn btn-danger" title="Apagar curso" ng-click="deleteCourse()"><i class="fa fa-trash-o"></i></button>
                </div>
                <div class="col-lg-6 textright">
                    <!-- <button class="btn btn-info">Listar | <i class="fa fa-star-o"></i></button> -->
                    <button class="btn btn-success" ng-click="saveCourse()">Salvar | <i class="fa fa-save"></i></button>
                    <button class="btn btn-warning" ng-click="publishCourse()">Publicar | <i class="fa fa-star-o"></i></button>
                </div>
            </div>
        </div>

    </div>
    <!-- END ACTIONS -->

    <!--  HEADER  -->
    <header class="container">
        <!--  PAGE-HEADER  -->
        <div class="page-header">
            <!--  ROW  -->
            <div class="row">
                <!--  COL-LG-9  -->
                <div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">
                    <h1><span ng-class="{'blink-text-danger':errors.name}" ng-model="course.name" placeholder="Nome do curso" contenteditable="true" tabindex="1"></span></h1>
                    <div class="course-slug clearfix">
                        <label>http://www.timtec.com.br/course/</label>
                        <strong>
                            <span ng-bind="course.name|slugify" ng-hide="course.slug"></span>
                            <span ng-model="course.slug" contenteditable></span>
                        </strong>
                    </div>

                    <ul class="instructors">
                        <li><a ng-click="professorsModalActive=true"><span class="icon-addable fa fa-plus-square left right"></span> Adicionar professores ao curso</a></li>
                    </ul>
                </div>
                <!--  END COL-LG-8  -->
                <!--  COL-LG-3  -->
                <div class="col-lg-3 col-sm-3">
                    <nav class="course-sections textright">
                        <a href=""><span class="has-tooltip fa fa-home" data-toggle="tooltip" data-placement="top" data-original-title="Intro"></span></a>
                        <a href=""><span class="has-tooltip fa fa-film" data-toggle="tooltip" data-placement="top" data-original-title="Aulas"></span></a>
                        <a href=""><span class="has-tooltip fa fa-comments" data-toggle="tooltip" data-placement="top" data-original-title="Fórum"></span></a>
                        <a href=""><span class="has-tooltip fa fa-file" data-toggle="tooltip" data-placement="top" data-original-title="Material Didádico"></span></a>
                    </nav>
                </div>
                <!--  END COL-LG-3  -->
            </div>
            <!--  END ROW  -->
        </div>
        <!--  END PAGE-HEADER  -->
    </header>
    <!--  END HEADER  -->

    <!--  COURSE CONTENT  -->
    <section id="course-content" class="container">
        <!--  ROW  -->
        <div class="row">
            <!--  COL-LG-9  -->
            <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12" ng-init="mediaSection='video'">
                <!-- ADD CONTENT -->
                <div class="add-content row">
                    <div class="col-lg-6">
                        <button ng-click="mediaSection='video'"
                                ng-class="{'btn-success':mediaSection=='video'}"
                                class="btn btn-default selected">Vídeo</button>

                        <button class="btn btn-default"
                                ng-class="{'btn-success':mediaSection=='thumbnail'}"
                                ng-click="mediaSection='thumbnail'">Thumbnail</button>
                    </div>
                </div>
                <!-- END ADD CONTENT -->

                <section class="thumbnail" ng-show="mediaSection=='thumbnail'" ng-init="thumbfile=null">

                    <div class="row" ng-show="addThumb" ng-init="addThumb=(thumbfile===null)">

                        <div class="add-thumbnail col-sm-12 col-lg-12 textcenter">
                            <div class="centered">
                                <div class="form-group">
                                    <i class="fa fa-picture-o fa-4x"></i>
                                    <h1 class="top">Thumbnail</h1>

                                    <file ng-model="thumbfile" name="thumbnail" class="form-control"></file>
                                </div>

                                <p>
                                    <button class="btn btn-danger btn-lg uppercase"
                                            ng-click="thumbfile=null; addThumb=!course.thumbnail_url">Cancelar</button>

                                    <button class="btn btn-success btn-lg uppercase"
                                            ng-click="addThumb=(thumbfile===null); saveThumb()">Adicionar</button>

                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="row" ng-show="!addThumb">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <img local-image ng-model="thumbfile" class="img-responsive"/>
                            {% verbatim %}
                            <img ng-src="{{course.thumbnail_url}}" class="img-responsive" ng-show="!thumbfile"/>
                            {% endverbatim %}
                        </div>

                        <div class="col-lg-12 textright">
                            <button class="btn-edit-thumbnail btn btn-success btn-sm uppercase"
                                    ng-click="addThumb=true">Alterar thumbnail</button>
                        </div>
                    </div>
                </section>

                <!--  COURSE-VIDEO  -->
                <section class="video" ng-show="mediaSection=='video'">
                    <div class="row">
                        <div class="waiting col-sm-12 col-lg-12 textcenter jumbotron"
                             style="height: 515px"
                             ng-show="course.intro_video.youtube_id && !playerReady">
                            <div class="middle">
                                <i class="fa fa-refresh fa-5x"></i>
                            </div>
                        </div>

                        <div class="col-lg-12" style="overflow:hidden;"
                             ng-style="{'margin-left': course.hasVideo() && playerReady ?'':'-2000px'}">

                            <div id="youtube-player" player-height="475px" player-width="100%" youtube-player></div>
                            <div class="row">
                                <div class="col-lg-10">
                                    <p class="video-title" ng-model="course.intro_video.name" placeholder="Nome do vídeo" contenteditable><p>
                                </div>
                                <div class="col-lg-2 textcenter">
                                    <button class="btn-edit-video btn btn-success btn-sm uppercase"
                                            ng-click="course.intro_video.youtube_id=''">Alterar vídeo</button>
                                </div>
                            </div>
                        </div>

                        <div class="add-video-intro col-sm-12 col-lg-12 textcenter"
                             ng-show="!course.intro_video.youtube_id">
                            <div class="centered">
                                <div class="form-group">
                                    <i class="fa fa-youtube-play fa-4x"></i>
                                    <h1 class="top">Vídeo de introdução</h1>
                                    <input type="text" tabindex="8" ng-model="youtube_id" class="form-control"/>
                                </div>

                                <p>
                                    <button class="btn btn-danger btn-lg uppercase"
                                            ng-click="course.intro_video.youtube_id=''">Cancelar</button>
                                    <button tabindex="9"
                                            class="btn btn-success btn-lg uppercase"
                                            ng-show="!course.intro_video.youtube_id"
                                            ng-click="course.intro_video.youtube_id=youtube_id">Adicionar</button>
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
                <!--  END COURSE-VIDEO  -->

                <!--  COURSE-INFO  -->
                <section class="course-info">
                    <!--  ROW  -->
                    <div class="row">
                        <!--  COL-LG-6  -->
                        <div class="application col-sm-6 col-lg-6">
                            <div class="page-header-double">
                                <h3 class="top"><i ng-class="{'blink-text-danger':errors.application}" class="fa fa-angle-double-right"></i> Aplicação do Conhecimento</h3>
                            </div>
                            <modalmarkdowneditor tabindex="6" on-save="saveCourse()" title="Aplicação do conhecimento" content="course.application"></modalmarkdowneditor>
                        </div>
                        <!--  END COL-LG-6  -->

                        <!--  COL-LG-6  -->
                        <div class="requirement col-sm-6 col-lg-6">
                            <div class="page-header-double">
                                <h3 class="top"><i ng-class="{'blink-text-danger':errors.requirement}" class="fa fa-angle-double-right"></i> O que preciso saber</h3>
                            </div>
                            <modalmarkdowneditor tabindex="7" on-save="saveCourse()" title="O que preciso saber?" content="course.requirement"></modalmarkdowneditor>

                        </div>
                        <!--  END COL-LG-6  -->
                    </div>
                    <!--  END ROW  -->
                </section>
                <!--  END COURSE-INFO  -->

                <!--  COURSE-LESSONS  -->
                <section class="lessons">
                    <!--  PAGE-HEADER-DOUBLE  -->
                    <div class="page-header-double">
                        <h3><i class="fa fa-angle-double-right"></i> Lições</h3>
                    </div>
                    <!--  END PAGE-HEADER-DOUBLE  -->

                    <p><a href="" ng-click="organizingLessons=true" ng-show="!organizingLessons">Organizar as lições</a></p>
                    <!-- <a href="" ng-click="organizingLessons=false" ng-show="organizingLessons">Lista detalhada de lições</a> -->

                    <!-- ORGANIZING LESSONS -->
                    <div class="lessons organizing-lessons" ng-show="organizingLessons"
                         sortable="lessons" on-update="repositionLessons()">

                        <!-- LESSON -->
                        <div class="lesson" ng-repeat="lesson in lessons">
                            <div class="row">
                                <div class="col-lg-11">
                                    <span class="handle"><span class="btn btn-warning"><i class="fa fa-bars"></i></span></span>
                                    <span class="title" ng-bind="lesson.name">Nome da lição</span>
                                </div>
                                <div class="col-lg-1 textright">
                                    <button class="btn btn-danger" ng-click="deleteLesson(lesson)"><i class="fa fa-trash-o"></i></button>
                                </div>
                            </div>
                        </div>
                        <!-- END LESSON -->

                        <div class="submit textright">
                            <button class="btn btn-danger" ng-click="organizingLessons=false">Cancelar</button>
                            <button class="btn btn-success" ng-click="saveAllLessons()">Salvar</button>
                        </div>
                    </div>
                    <!-- END ORGANIZING LESSONS -->

                    <!--  LESSON  -->
                    <div class="lesson row" ng-repeat="lesson in lessons" ng-hide="organizingLessons">
                        <!--  COL-LG-3  -->
                        <div class="col-lg-3 col-sm-3 col-sm-3 hidden-xs">
                            {% verbatim %}
                            <img ng-src="{{ lesson.thumbnail }}" class="img-thumbnail">
                            {% endverbatim %}
                        </div>
                        <!--  END COL-LG-3  -->

                        <!--  COL-LG-9  -->
                        <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                            <p>
                                {% verbatim %}
                                <a href="lessons/{{lesson.id}}" class="title editable" ng-bind="lesson.name">Nome da lição</a>
                                {% endverbatim %}
                                <modalmarkdowneditor on-save="saveLesson(lesson)" title="Descrição da lição" content="lesson.desc"></modalmarkdowneditor>
                            </p>
                            <!--  HIDDEN-XS  -->
                            <div class="hidden-xs" ng-show="lesson.units">
                                <table class="table units">
                                    <tbody>
                                        <tr>
                                            <td ng-repeat="unit in lesson.units">
                                                {% verbatim %}
                                                <span class="has-tooltip unit " data-toggle="tooltip"
                                                      data-placement="bottom" data-original-title="{{unit.title}}">
                                                    <i class="fa fa-list" ng-show="unit.activities"></i>
                                                </span>
                                                {% endverbatim %}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!--  END HIDDEN-XS  -->
                            {% verbatim %}
                            <p><i class="fa fa-youtube-play"></i> <small>{{ lesson.countVideos() }} videos</small> | <i class="fa fa-list"></i> <small>{{ lesson.countActivities() }} atividades</small></p>
                            {% endverbatim %}
                        </div>
                        <!--  END COL-LG-9  -->
                    </div>
                    <!--  END LESSON  -->

                    <div class="row textcenter">
                        <div class="col-lg-12">
                            {% verbatim %}
                            <a href="/admin/courses/{{course.id}}/lessons/new" class="col-lg-12 btn btn-lg btn-default uppercase">{% endverbatim %}Adicionar lição</a>
                        </div>
                    </div>

                </section>
                <!--  END COURSE-LESSONS  -->

                <!-- INSTRUCTORS -->
                <section class="instructors">
                    <!-- PAGE-HEADER-DOUBLE -->
                    <div class="page-header-double">
                        <h3><i class="fa fa-angle-double-right"></i> Instrutores</h3>
                    </div>
                    <!-- END PAGE-HEADER-DOUBLE -->

                    <!-- <a href="" ng-click="organizingInstructors=false" ng-show="organizingInstructors">Editar biografias</a> -->
                    <p><a href="" ng-click="organizingInstructors=true" ng-hide="organizingInstructors">Organizar instrutores</a></p>

                    <div class="instructors organizing-instructors" ng-show="organizingInstructors">
                        <div class="instructor" ng-repeat="professor in courseProfessors">
                            <div class="row">
                                <div class="col-lg-11">
                                    <button class="btn btn-warning"><i class="fa fa-bars"></i></button>
                                    <span class="title" ng-bind="professor.user_info.name">Nome do professor</span>
                                </div>
                                <div class="col-lg-1 textright">
                                    <button class="btn btn-danger"
                                            ng-click="deleteProfessor(professor)">
                                        <i class="fa fa-trash-o"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="submit textright">
                            <button class="btn btn-danger" ng-click="organizingInstructors=false">Cancelar</button>
                            <button class="btn btn-success">Salvar</button>
                        </div>
                    </div>

                    <!-- INSTRUCTOR -->
                    <div id="" class="instructor row" ng-repeat="professor in courseProfessors" ng-hide="organizingInstructors">
                        <div class="col-lg-3 col-sm-3">
                            {% verbatim %}
                            <img ng-src="{{ professor.user_info.picture }}"
                                 onerror="this.src='/static/img/avatar-default.png'"
                                 class="img-thumbnail">
                            {% endverbatim %}
                        </div>
                        <div class="col-lg-9 col-sm-9">
                            <h1 class="fullname bottom top" ng-bind="professor.user_info.name">Nome do professor</h1>
                            <h2 class="job-title top"></h2>
                            <modalmarkdowneditor title="Biografia" on-save="saveProfessor(professor)" content="professor.biography"></modalmarkdowneditor>
                        </div>
                    </div>
                    <!-- END INSTRUCTOR -->

                    <div class="row textcenter">
                        <div class="col-lg-12">
                            <a ng-click="professorsModalActive=true" class="col-lg-12 btn btn-lg btn-default uppercase">Adicionar instrutor</a>
                        </div>
                    </div>
                </section>
                <!-- END INSTRUCTORS -->
            </div>
            <!--  END COL-LG-9  -->

            <!--  COL-LG-3  -->
            <div class="col-lg-3 col-md-3 col-sm-3">
                <!--   COURSE-SUMMARY  -->
                <section class="summary">

                    <!--  ABSTRACT  -->
                    <div class="page-header-double top">
                        <h3 class="top"><i ng-class="{'blink-text-danger':errors.abstract}" class="fa fa-angle-double-right"></i> Resumo</h3>

                    </div>
                    <modalmarkdowneditor tabindex="2" on-save="saveCourse()" title="Resumo" content="course.abstract"></modalmarkdowneditor>

                    <hr/>
                    <!--  END ABSTRACT  -->

                    <!--  STRUCTURE  -->
                    <div class="page-header-double top">
                        <h3 class="top"><i ng-class="{'blink-text-danger':errors.structure}" class="fa fa-angle-double-right"></i> Estrutura do curso</h3>
                    </div>
                    <modalmarkdowneditor tabindex="3" on-save="saveCourse()" title="Estrutura do curso" content="course.structure"></modalmarkdowneditor>

                    <hr/>
                    <!--  END STRUCTURE  -->

                    <!--  WORKLOAD  -->
                    <div class="page-header-double top">
                        <h3 class="top"><i ng-class="{'blink-text-danger':errors.workload}" class="fa fa-angle-double-right"></i> Carga horária</h3>
                    </div>
                    <modalmarkdowneditor tabindex="4" on-save="saveCourse()" title="Carga horária" content="course.workload"></modalmarkdowneditor>

                    <hr/>
                    <!--  END WORKLOAD  -->

                    <div class="page-header-double top">
                        <h3 class="top"><i class="fa fa-angle-double-right"></i> Texto PRONATEC</h3>
                    </div>
                    <modalmarkdowneditor tabindex="5" on-save="saveCourse()" title="PRONATEC" content="course.pronatec"></modalmarkdowneditor>

                </section>
                <!--  END COURSE-SUMMARY  -->
            </div>
            <!--  END COL-LG-3  -->
        </div>
        <!--  ROW  -->
    </section>
    <!--  END COURSE CONTENT  -->


    <!-- ALERT -->
    <div class="tt-popup notifications" alert-popup ng-class="{'hideTop': alert.hidden}">
        <div class="alert fade in" ng-class="'alert-' + alert.type">
            <button type="button" class="close" ng-click="alert.hidden=true">×</button>
            <h4 ng-bind="alert.title"></h4>
            <p class="bottom">
                <ol class="bottom">
                    <li ng-repeat="message in alert.messages" ng-bind="message"></li>
                </ol>
            </p>
            <div ng-show="alert.showControls">
                <hr/>
                <button type="button" class="btn" ng-class="'btn-'+alert.type"
                         ng-click="alert.hidden=true">Fechar</button>
            </div>
        </div>
    </div>
    <!-- ALERT -->
    <professorslist on-select="addProfessor" active="professorsModalActive"><professorslist>
</div>
<!--  END COURSE CONTENT  -->

{% endblock %}
